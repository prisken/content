{% extends "base.html" %}

{% block title %}Content Generator - Content Creator Pro{% endblock %}

{% block extra_css %}
<style>
    .direction-card {
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }
    
    .direction-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .direction-card.selected {
        border-color: #0d6efd;
        background-color: #f8f9ff;
    }
    
    .step-indicator {
        background: linear-gradient(90deg, #e9ecef 0%, #e9ecef 100%);
        height: 4px;
        border-radius: 2px;
        margin: 20px 0;
    }
    
    .step-indicator .progress {
        background: linear-gradient(90deg, #0d6efd 0%, #0d6efd 100%);
        height: 100%;
        border-radius: 2px;
        transition: width 0.3s ease;
    }
    
    .content-preview {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
        padding: 20px;
        min-height: 200px;
    }
    
    .quick-start-card {
        cursor: pointer;
        transition: all 0.3s ease;
    }
    
    .quick-start-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .news-source-card {
        cursor: pointer;
        transition: all 0.3s ease;
        border: 2px solid transparent;
    }
    
    .news-source-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
    }
    
    .news-source-card.selected {
        border-color: #0d6efd;
        background-color: #f8f9ff;
    }
</style>
{% endblock %}

{% block content %}
<div class="container">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <h1 class="h2 mb-2">
                <i class="fas fa-magic me-2 text-primary"></i><span data-translate="content_generator">Content Generator</span>
            </h1>
            <p class="text-muted" data-translate="generate_content_desc">Create engaging content in minutes with AI-powered generation</p>
        </div>
    </div>

    <!-- Quick Start Options -->
    <div class="row mb-4">
        <div class="col-12">
            <h5 class="mb-3" data-translate="quick_start">Quick Start</h5>
            
            <!-- Quick Start with Preferences -->
            <div id="preferencesQuickStart" class="mb-3" style="display: none;">
                <div class="alert alert-info">
                    <div class="d-flex align-items-center">
                        <i class="fas fa-magic me-2"></i>
                        <div class="flex-grow-1">
                            <strong data-translate="quick_start_preferences">Use Your Preferences</strong>
                            <br>
                            <small data-translate="generate_content_desc">Generate content based on your saved preferences</small>
                        </div>
                        <button class="btn btn-primary btn-sm" onclick="quickStartWithPreferences()">
                            <i class="fas fa-rocket me-1"></i><span data-translate="quick_start">Quick Start</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="row">
                <div class="col-md-3 mb-3">
                    <div class="card quick-start-card h-100" data-quick-start="business-linkedin">
                        <div class="card-body text-center">
                            <i class="fas fa-briefcase fa-2x text-primary mb-2"></i>
                            <h6 class="card-title">Business News → LinkedIn</h6>
                            <small class="text-muted">Professional insights</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card quick-start-card h-100" data-quick-start="tech-twitter">
                        <div class="card-body text-center">
                            <i class="fas fa-microchip fa-2x text-primary mb-2"></i>
                            <h6 class="card-title">Tech Trends → Twitter</h6>
                            <small class="text-muted">Quick updates</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card quick-start-card h-100" data-quick-start="health-instagram">
                        <div class="card-body text-center">
                            <i class="fas fa-heart fa-2x text-primary mb-2"></i>
                            <h6 class="card-title">Health Tips → Instagram</h6>
                            <small class="text-muted">Visual inspiration</small>
                        </div>
                    </div>
                </div>
                <div class="col-md-3 mb-3">
                    <div class="card quick-start-card h-100" data-quick-start="education-blog">
                        <div class="card-body text-center">
                            <i class="fas fa-graduation-cap fa-2x text-primary mb-2"></i>
                            <h6 class="card-title">Industry Insights → Blog</h6>
                            <small class="text-muted">In-depth content</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Generation Form -->
    <div class="row">
        <div class="col-lg-8">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0" data-translate="generate_content">Create Your Content</h5>
                </div>
                <div class="card-body">
                    <!-- Step Indicator -->
                    <div class="step-indicator">
                        <div class="progress" id="stepProgress" style="width: 25%"></div>
                    </div>

                    <!-- Step 1: Content Direction -->
                    <div id="step1" class="step-content">
                        <h6 class="mb-3"><span data-translate="step_1">Step 1</span>: <span data-translate="choose_direction">Choose Your Focus</span></h6>
                        <div class="row" id="directionGrid">
                            <!-- Directions will be loaded dynamically -->
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-primary" onclick="nextStep()" disabled id="step1Next">
                                <span data-translate="next">Next</span> <i class="fas fa-arrow-right ms-1"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 2: Content Type -->
                    <div id="step2" class="step-content" style="display: none;">
                        <h6 class="mb-3"><span data-translate="step_2">Step 2</span>: <span data-translate="choose_platform">What Type of Content?</span></h6>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-content-type="linkedin">
                                    <div class="card-body text-center">
                                        <i class="fab fa-linkedin fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title" data-translate="linkedin">LinkedIn Post</h6>
                                        <small class="text-muted">Professional networking</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-content-type="facebook">
                                    <div class="card-body text-center">
                                        <i class="fab fa-facebook fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title" data-translate="facebook">Facebook Post</h6>
                                        <small class="text-muted">Community engagement</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-content-type="instagram">
                                    <div class="card-body text-center">
                                        <i class="fab fa-instagram fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title" data-translate="instagram">Instagram Post</h6>
                                        <small class="text-muted">Visual storytelling</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-content-type="twitter">
                                    <div class="card-body text-center">
                                        <i class="fab fa-twitter fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title" data-translate="twitter">Twitter Post</h6>
                                        <small class="text-muted">Quick updates</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-content-type="youtube_shorts">
                                    <div class="card-body text-center">
                                        <i class="fab fa-youtube fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title" data-translate="youtube_shorts">YouTube Shorts</h6>
                                        <small class="text-muted">Video content</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-content-type="blog">
                                    <div class="card-body text-center">
                                        <i class="fas fa-blog fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title" data-translate="blog_article">Blog Article</h6>
                                        <small class="text-muted">In-depth content</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-secondary me-2" onclick="prevStep()">
                                <i class="fas fa-arrow-left me-1"></i> <span data-translate="back">Back</span>
                            </button>
                            <button class="btn btn-primary" onclick="nextStep()" disabled id="step2Next">
                                <span data-translate="next">Next</span> <i class="fas fa-arrow-right ms-1"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 3: Information Source -->
                    <div id="step3" class="step-content" style="display: none;">
                        <h6 class="mb-3"><span data-translate="step_3">Step 3</span>: <span data-translate="what_inspires">What Inspires You?</span></h6>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-source-type="news">
                                    <div class="card-body text-center">
                                        <i class="fas fa-newspaper fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title">Latest News</h6>
                                        <small class="text-muted">Current events</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-source-type="books">
                                    <div class="card-body text-center">
                                        <i class="fas fa-book fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title">Popular Books</h6>
                                        <small class="text-muted">Expert insights</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-source-type="threads">
                                    <div class="card-body text-center">
                                        <i class="fas fa-comments fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title">Trending Threads</h6>
                                        <small class="text-muted">Viral discussions</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-source-type="podcasts">
                                    <div class="card-body text-center">
                                        <i class="fas fa-podcast fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title">Podcasts</h6>
                                        <small class="text-muted">Audio insights</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-source-type="videos">
                                    <div class="card-body text-center">
                                        <i class="fas fa-video fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title">YouTube Videos</h6>
                                        <small class="text-muted">Visual content</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-source-type="research">
                                    <div class="card-body text-center">
                                        <i class="fas fa-microscope fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title">Research Papers</h6>
                                        <small class="text-muted">Academic insights</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-secondary me-2" onclick="prevStep()">
                                <i class="fas fa-arrow-left me-1"></i> Back
                            </button>
                            <button class="btn btn-primary" onclick="nextStep()" disabled id="step3Next">
                                Next <i class="fas fa-arrow-right ms-1"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 3.5: News Source Selection (only for news) -->
                    <div id="step3_5" class="step-content" style="display: none;">
                        <h6 class="mb-3">Step 3.5: Choose Your News Source</h6>
                        <div class="mb-3">
                            <label class="form-label">Select your preferred region:</label>
                            <select class="form-select" id="newsRegion" onchange="updateNewsSources()">
                                <option value="">Choose a region...</option>
                                <option value="north_america">North America</option>
                                <option value="europe">Europe</option>
                                <option value="asia_pacific">Asia Pacific</option>
                                <option value="latin_america">Latin America</option>
                                <option value="middle_east">Middle East</option>
                                <option value="africa">Africa</option>
                            </select>
                        </div>
                        
                        <div id="newsSourcesContainer" style="display: none;">
                            <label class="form-label">Select news source:</label>
                            <div class="row" id="newsSourcesGrid">
                                <!-- News sources will be loaded dynamically based on region -->
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            <button class="btn btn-secondary me-2" onclick="prevStep()">
                                <i class="fas fa-arrow-left me-1"></i> Back
                            </button>
                            <button class="btn btn-primary" onclick="nextStep()" disabled id="step3_5Next">
                                Next <i class="fas fa-arrow-right ms-1"></i>
                            </button>
                        </div>
                    </div>

                    <!-- Step 4: Tone Selection -->
                    <div id="step4" class="step-content" style="display: none;">
                        <h6 class="mb-3">Step 4: How Should It Sound?</h6>
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-tone="professional">
                                    <div class="card-body text-center">
                                        <i class="fas fa-user-tie fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title">Professional</h6>
                                        <small class="text-muted">Business formal</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-tone="casual">
                                    <div class="card-body text-center">
                                        <i class="fas fa-smile fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title">Casual</h6>
                                        <small class="text-muted">Friendly informal</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-tone="inspirational">
                                    <div class="card-body text-center">
                                        <i class="fas fa-star fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title">Inspirational</h6>
                                        <small class="text-muted">Motivational</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-tone="educational">
                                    <div class="card-body text-center">
                                        <i class="fas fa-chalkboard-teacher fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title">Educational</h6>
                                        <small class="text-muted">Informative</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-tone="humorous">
                                    <div class="card-body text-center">
                                        <i class="fas fa-laugh fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title">Humorous</h6>
                                        <small class="text-muted">Fun and light</small>
                                    </div>
                                </div>
                            </div>
                            <div class="col-md-4 mb-3">
                                <div class="card direction-card h-100" data-tone="serious">
                                    <div class="card-body text-center">
                                        <i class="fas fa-exclamation-triangle fa-2x text-primary mb-2"></i>
                                        <h6 class="card-title">Serious</h6>
                                        <small class="text-muted">Important matters</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3">
                            <button class="btn btn-secondary me-2" onclick="prevStep()">
                                <i class="fas fa-arrow-left me-1"></i> Back
                            </button>
                            <button class="btn btn-success" onclick="generateContent()" disabled id="generateBtn">
                                <i class="fas fa-magic me-1"></i> Generate Content
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Preview Panel -->
        <div class="col-lg-4">
            <div class="card">
                <div class="card-header">
                    <h5 class="mb-0">Content Preview</h5>
                </div>
                <div class="card-body">
                    <div class="content-preview" id="contentPreview">
                        <div class="text-center text-muted">
                            <i class="fas fa-eye fa-3x mb-3"></i>
                            <p>Your generated content will appear here</p>
                        </div>
                    </div>
                    
                    <!-- Translation Controls -->
                    <div id="translationControls" style="display: none;">
                        <hr>
                        <div class="translation-controls">
                            <h6 class="mb-2">Translate Content</h6>
                            <div class="mb-2">
                                <span class="content-language en">English</span>
                                <span class="content-language zh" style="display: none;">中文</span>
                            </div>
                            <div class="d-grid gap-2">
                                <button class="btn btn-outline-primary" onclick="translateContent('en')" id="translateEn">
                                    <i class="fas fa-language me-1"></i> Show English
                                </button>
                                <button class="btn btn-outline-warning" onclick="translateContent('zh')" id="translateZh">
                                    <i class="fas fa-language me-1"></i> 显示中文
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div id="contentActions" style="display: none;">
                        <hr>
                        <div class="d-grid gap-2">
                            <button class="btn btn-outline-primary" onclick="saveContent()">
                                <i class="fas fa-save me-1"></i> Save to Library
                            </button>
                            <button class="btn btn-outline-success" onclick="downloadContent()">
                                <i class="fas fa-download me-1"></i> Download
                            </button>
                            <button class="btn btn-outline-info" onclick="copyContent()">
                                <i class="fas fa-copy me-1"></i> Copy Text
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
let currentStep = 1;
let selectedDirection = null;
let selectedContentType = null;
let selectedSourceType = null;
let selectedNewsSource = null;
let selectedTone = null;
let generatedContent = null;
let currentContentLanguage = 'en';

// Initialize the page
$(document).ready(function() {
    loadDirections();
    setupEventListeners();
    loadUserPreferences();
});

function loadDirections() {
    fetch('/api/directions')
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                renderDirections(data.directions);
            }
        })
        .catch(error => {
            console.error('Error loading directions:', error);
            // Fallback to hardcoded directions
            renderDirections(getDefaultDirections());
        });
}

function renderDirections(directions) {
    const grid = $('#directionGrid');
    grid.empty();
    
    directions.forEach(direction => {
        const card = `
            <div class="col-md-4 mb-3">
                <div class="card direction-card h-100" data-direction="${direction.key}">
                    <div class="card-body text-center">
                        <i class="fas ${getDirectionIcon(direction.key)} fa-2x text-primary mb-2"></i>
                        <h6 class="card-title">${direction.name}</h6>
                        <small class="text-muted">${direction.subcategories.join(', ')}</small>
                    </div>
                </div>
            </div>
        `;
        grid.append(card);
    });
}

function getDirectionIcon(directionKey) {
    const icons = {
        'business_finance': 'fa-briefcase',
        'technology': 'fa-microchip',
        'health_wellness': 'fa-heart',
        'education': 'fa-graduation-cap',
        'entertainment': 'fa-film',
        'travel_tourism': 'fa-plane',
        'food_cooking': 'fa-utensils',
        'fashion_beauty': 'fa-tshirt',
        'sports_fitness': 'fa-dumbbell',
        'science_research': 'fa-microscope',
        'politics_current_events': 'fa-newspaper',
        'environment_sustainability': 'fa-leaf',
        'personal_development': 'fa-user-graduate',
        'parenting_family': 'fa-users',
        'art_creativity': 'fa-palette',
        'real_estate': 'fa-home',
        'automotive': 'fa-car',
        'pet_care': 'fa-paw'
    };
    return icons[directionKey] || 'fa-tag';
}

function getDefaultDirections() {
    return [
        { key: 'business_finance', name: 'Business & Finance', subcategories: ['entrepreneurship', 'investing'] },
        { key: 'technology', name: 'Technology', subcategories: ['tech_news', 'software'] },
        { key: 'health_wellness', name: 'Health & Wellness', subcategories: ['fitness', 'nutrition'] },
        { key: 'education', name: 'Education', subcategories: ['learning', 'skills'] },
        { key: 'entertainment', name: 'Entertainment', subcategories: ['movies', 'music'] },
        { key: 'travel_tourism', name: 'Travel & Tourism', subcategories: ['destinations', 'tips'] }
    ];
}

function loadUserPreferences() {
    // Load saved preferences from localStorage
    const preferences = JSON.parse(localStorage.getItem('contentPreferences') || '{}');
    
    // Apply primary direction if set
    if (preferences.primaryDirection) {
        selectedDirection = preferences.primaryDirection;
        // Highlight the selected direction card
        $(`[data-direction="${selectedDirection}"]`).addClass('selected');
        $('#step1Next').prop('disabled', false);
    }
    
    // Apply default tone if set
    if (preferences.defaultTone) {
        selectedTone = preferences.defaultTone;
    }
    
    // Apply preferred content types to quick start cards
    if (preferences.preferredContentTypes && preferences.preferredContentTypes.length > 0) {
        updateQuickStartCards(preferences.preferredContentTypes);
    }
    
    // Apply favorite sources
    if (preferences.favoriteSources && preferences.favoriteSources.length > 0) {
        selectedSourceType = preferences.favoriteSources[0]; // Use first preferred source
    }
    
    // Show preferences quick start if user has saved preferences
    if (preferences.primaryDirection && preferences.preferredContentTypes && preferences.preferredContentTypes.length > 0) {
        $('#preferencesQuickStart').show();
    }
}

function quickStartWithPreferences() {
    const preferences = JSON.parse(localStorage.getItem('contentPreferences') || '{}');
    
    if (!preferences.primaryDirection || !preferences.preferredContentTypes || preferences.preferredContentTypes.length === 0) {
        alert('Please set your content preferences in Settings first.');
        return;
    }
    
    // Set selections based on preferences
    selectedDirection = preferences.primaryDirection;
    selectedContentType = preferences.preferredContentTypes[0]; // Use first preferred type
    selectedSourceType = preferences.favoriteSources && preferences.favoriteSources.length > 0 ? preferences.favoriteSources[0] : 'news';
    selectedTone = preferences.defaultTone || 'professional';
    
    // Jump to step 4 (tone selection) with pre-filled selections
    currentStep = 4;
    showStep(4);
    updateProgress();
    
    // Pre-select the tone
    $(`[data-tone="${selectedTone}"]`).addClass('selected');
    $('#generateBtn').prop('disabled', false);
    
    // Show success message
    showPreferenceMessage('Content preferences applied! Ready to generate.');
}

function showPreferenceMessage(message) {
    const alertDiv = document.createElement('div');
    alertDiv.className = 'alert alert-success alert-dismissible fade show position-fixed';
    alertDiv.style.cssText = 'top: 20px; right: 20px; z-index: 9999; min-width: 300px;';
    alertDiv.innerHTML = `
        <i class="fas fa-check-circle me-2"></i>${message}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    `;
    
    document.body.appendChild(alertDiv);
    
    setTimeout(() => {
        if (alertDiv.parentNode) {
            alertDiv.parentNode.removeChild(alertDiv);
        }
    }, 3000);
}

function updateQuickStartCards(preferredTypes) {
    // Update quick start cards based on preferred content types
    const directionContent = getDirectionSpecificContent();
    const preferredType = preferredTypes[0] || 'linkedin'; // Default to LinkedIn
    
    // Update quick start cards with preferred content type
    $('.quick-start-card').each(function() {
        const card = $(this);
        const quickStart = card.data('quick-start');
        const [direction] = quickStart.split('-');
        
        // Update card to use preferred content type
        card.data('quick-start', `${direction}-${preferredType}`);
        
        // Update card title
        const contentTypeNames = {
            'linkedin': 'LinkedIn',
            'facebook': 'Facebook',
            'instagram': 'Instagram',
            'twitter': 'Twitter',
            'youtube_shorts': 'YouTube Shorts',
            'blog': 'Blog'
        };
        
        const directionNames = {
            'business': 'Business News',
            'tech': 'Tech Trends',
            'health': 'Health Tips',
            'education': 'Industry Insights'
        };
        
        card.find('.card-title').text(`${directionNames[direction] || direction} → ${contentTypeNames[preferredType]}`);
    });
}

function setupEventListeners() {
    // Direction selection
    $(document).on('click', '[data-direction]', function() {
        $('.direction-card').removeClass('selected');
        $(this).addClass('selected');
        selectedDirection = $(this).data('direction');
        $('#step1Next').prop('disabled', false);
    });

    // Content type selection
    $(document).on('click', '[data-content-type]', function() {
        $('.direction-card').removeClass('selected');
        $(this).addClass('selected');
        selectedContentType = $(this).data('content-type');
        $('#step2Next').prop('disabled', false);
    });

    // Source type selection
    $(document).on('click', '[data-source-type]', function() {
        $('.direction-card').removeClass('selected');
        $(this).addClass('selected');
        selectedSourceType = $(this).data('source-type');
        $('#step3Next').prop('disabled', false);
    });

    // Tone selection
    $(document).on('click', '[data-tone]', function() {
        $('.direction-card').removeClass('selected');
        $(this).addClass('selected');
        selectedTone = $(this).data('tone');
        $('#generateBtn').prop('disabled', false);
    });

    // Quick start cards
    $(document).on('click', '.quick-start-card', function() {
        const quickStart = $(this).data('quick-start');
        const [direction, contentType] = quickStart.split('-');
        
        selectedDirection = direction;
        selectedContentType = contentType;
        selectedSourceType = 'news';
        selectedTone = 'professional';
        
        // Jump to step 4
        currentStep = 4;
        showStep(4);
        updateProgress();
        $('#generateBtn').prop('disabled', false);
    });

    // News source selection
    $(document).on('click', '[data-news-source]', function() {
        $('.news-source-card').removeClass('selected');
        $(this).addClass('selected');
        selectedNewsSource = $(this).data('news-source');
        $('#step3_5Next').prop('disabled', false);
    });
}

// News sources data based on content categories document
const newsSources = {
    north_america: {
        general: [
            { name: 'CNN', url: 'cnn.com', category: 'General News' },
            { name: 'Fox News', url: 'foxnews.com', category: 'General News' },
            { name: 'NBC News', url: 'nbcnews.com', category: 'General News' },
            { name: 'ABC News', url: 'abcnews.go.com', category: 'General News' }
        ],
        business: [
            { name: 'Bloomberg', url: 'bloomberg.com', category: 'Business News' },
            { name: 'CNBC', url: 'cnbc.com', category: 'Business News' },
            { name: 'Wall Street Journal', url: 'wsj.com', category: 'Business News' },
            { name: 'Forbes', url: 'forbes.com', category: 'Business News' }
        ],
        tech: [
            { name: 'TechCrunch', url: 'techcrunch.com', category: 'Tech News' },
            { name: 'The Verge', url: 'theverge.com', category: 'Tech News' },
            { name: 'Wired', url: 'wired.com', category: 'Tech News' },
            { name: 'Ars Technica', url: 'arstechnica.com', category: 'Tech News' }
        ]
    },
    europe: {
        general: [
            { name: 'BBC', url: 'bbc.com', category: 'General News' },
            { name: 'Reuters', url: 'reuters.com', category: 'General News' },
            { name: 'The Guardian', url: 'theguardian.com', category: 'General News' },
            { name: 'Le Monde', url: 'lemonde.fr', category: 'General News' }
        ],
        business: [
            { name: 'Financial Times', url: 'ft.com', category: 'Business News' },
            { name: 'The Economist', url: 'economist.com', category: 'Business News' },
            { name: 'Handelsblatt', url: 'handelsblatt.com', category: 'Business News' }
        ],
        tech: [
            { name: 'Tech.eu', url: 'tech.eu', category: 'Tech News' },
            { name: 'The Next Web', url: 'thenextweb.com', category: 'Tech News' },
            { name: 'EU-Startups', url: 'eu-startups.com', category: 'Tech News' }
        ]
    },
    asia_pacific: {
        general: [
            { name: 'Nikkei', url: 'asia.nikkei.com', category: 'General News' },
            { name: 'South China Morning Post', url: 'scmp.com', category: 'General News' },
            { name: 'Straits Times', url: 'straitstimes.com', category: 'General News' }
        ],
        business: [
            { name: 'Bloomberg Asia', url: 'bloomberg.com/asia', category: 'Business News' },
            { name: 'CNBC Asia', url: 'cnbc.com/asia', category: 'Business News' },
            { name: 'Nikkei Business', url: 'business.nikkei.com', category: 'Business News' }
        ],
        tech: [
            { name: 'Tech in Asia', url: 'techinasia.com', category: 'Tech News' },
            { name: 'KrASIA', url: 'kr-asia.com', category: 'Tech News' },
            { name: '36Kr', url: '36kr.com', category: 'Tech News' }
        ]
    },
    latin_america: {
        general: [
            { name: 'El País', url: 'elpais.com', category: 'General News' },
            { name: 'Folha de S.Paulo', url: 'folha.uol.com.br', category: 'General News' },
            { name: 'Clarín', url: 'clarin.com', category: 'General News' }
        ],
        business: [
            { name: 'América Economía', url: 'americaeconomia.com', category: 'Business News' },
            { name: 'Valor Econômico', url: 'valor.com.br', category: 'Business News' }
        ],
        tech: [
            { name: 'TechCrunch Latin America', url: 'techcrunch.com/latam', category: 'Tech News' },
            { name: 'Contxto', url: 'contxto.com', category: 'Tech News' },
            { name: 'PulsoSocial', url: 'pulsosocial.com', category: 'Tech News' }
        ]
    },
    middle_east: {
        general: [
            { name: 'Al Jazeera', url: 'aljazeera.com', category: 'General News' },
            { name: 'Gulf News', url: 'gulfnews.com', category: 'General News' },
            { name: 'The National', url: 'thenational.ae', category: 'General News' }
        ],
        business: [
            { name: 'Arabian Business', url: 'arabianbusiness.com', category: 'Business News' },
            { name: 'MEED', url: 'meed.com', category: 'Business News' },
            { name: 'Gulf Business', url: 'gulfbusiness.com', category: 'Business News' }
        ],
        tech: [
            { name: 'Wamda', url: 'wamda.com', category: 'Tech News' },
            { name: 'MENAbytes', url: 'menabytes.com', category: 'Tech News' },
            { name: 'Magnitt', url: 'magnitt.com', category: 'Tech News' }
        ]
    },
    africa: {
        general: [
            { name: 'Business Day', url: 'businessday.ng', category: 'General News' },
            { name: 'Daily Nation', url: 'nation.co.ke', category: 'General News' },
            { name: 'The East African', url: 'theeastafrican.co.ke', category: 'General News' }
        ],
        business: [
            { name: 'African Business', url: 'africanbusinessmagazine.com', category: 'Business News' },
            { name: 'Ventures Africa', url: 'venturesafrica.com', category: 'Business News' }
        ],
        tech: [
            { name: 'TechCabal', url: 'techcabal.com', category: 'Tech News' },
            { name: 'Disrupt Africa', url: 'disrupt-africa.com', category: 'Tech News' },
            { name: 'WeeTracker', url: 'weetracker.com', category: 'Tech News' }
        ]
    }
};

function updateNewsSources() {
    const region = $('#newsRegion').val();
    const container = $('#newsSourcesContainer');
    const grid = $('#newsSourcesGrid');
    
    if (!region) {
        container.hide();
        return;
    }
    
    const sources = newsSources[region];
    if (!sources) {
        container.hide();
        return;
    }
    
    grid.empty();
    
    // Add General News sources
    if (sources.general && sources.general.length > 0) {
        grid.append('<div class="col-12"><h6 class="text-muted mb-2">General News</h6></div>');
        sources.general.forEach(source => {
            const card = `
                <div class="col-md-4 mb-2">
                    <div class="card news-source-card h-100" data-news-source="${source.name}">
                        <div class="card-body text-center p-2">
                            <i class="fas fa-newspaper text-primary mb-1"></i>
                            <h6 class="card-title mb-1">${source.name}</h6>
                            <small class="text-muted">${source.category}</small>
                        </div>
                    </div>
                </div>
            `;
            grid.append(card);
        });
    }
    
    // Add Business News sources
    if (sources.business && sources.business.length > 0) {
        grid.append('<div class="col-12"><h6 class="text-muted mb-2 mt-3">Business News</h6></div>');
        sources.business.forEach(source => {
            const card = `
                <div class="col-md-4 mb-2">
                    <div class="card news-source-card h-100" data-news-source="${source.name}">
                        <div class="card-body text-center p-2">
                            <i class="fas fa-chart-line text-primary mb-1"></i>
                            <h6 class="card-title mb-1">${source.name}</h6>
                            <small class="text-muted">${source.category}</small>
                        </div>
                    </div>
                </div>
            `;
            grid.append(card);
        });
    }
    
    // Add Tech News sources
    if (sources.tech && sources.tech.length > 0) {
        grid.append('<div class="col-12"><h6 class="text-muted mb-2 mt-3">Tech News</h6></div>');
        sources.tech.forEach(source => {
            const card = `
                <div class="col-md-4 mb-2">
                    <div class="card news-source-card h-100" data-news-source="${source.name}">
                        <div class="card-body text-center p-2">
                            <i class="fas fa-microchip text-primary mb-1"></i>
                            <h6 class="card-title mb-1">${source.name}</h6>
                            <small class="text-muted">${source.category}</small>
                        </div>
                    </div>
                </div>
            `;
            grid.append(card);
        });
    }
    
    container.show();
}

function nextStep() {
    if (currentStep === 3 && selectedSourceType === 'news') {
        // If news is selected, go to step 3.5
        currentStep = 3.5;
        showStep(3.5);
        updateProgress();
    } else if (currentStep < 4) {
        currentStep++;
        showStep(currentStep);
        updateProgress();
    }
}

function prevStep() {
    if (currentStep === 3.5) {
        // Go back to step 3 from step 3.5
        currentStep = 3;
        showStep(3);
        updateProgress();
    } else if (currentStep > 1) {
        currentStep--;
        showStep(currentStep);
        updateProgress();
    }
}

function showStep(step) {
    $('.step-content').hide();
    if (step === 3.5) {
        $('#step3_5').show();
    } else {
        $(`#step${step}`).show();
    }
}

function updateProgress() {
    const totalSteps = selectedSourceType === 'news' ? 4.5 : 4;
    const progress = (currentStep / totalSteps) * 100;
    $('#stepProgress').css('width', progress + '%');
}

function generateContent() {
    if (!selectedDirection || !selectedContentType || !selectedSourceType || !selectedTone) {
        alert('Please complete all steps before generating content.');
        return;
    }
    
    // Additional validation for news source
    if (selectedSourceType === 'news' && !selectedNewsSource) {
        alert('Please select a news source before generating content.');
        return;
    }

    // Show loading state
    $('#generateBtn').prop('disabled', true).html('<i class="fas fa-spinner fa-spin me-1"></i> Generating...');
    
    // Mock content generation for now
    setTimeout(() => {
        const mockContent = generateMockContent();
        displayContent(mockContent);
        $('#generateBtn').prop('disabled', false).html('<i class="fas fa-magic me-1"></i> Generate Content');
    }, 2000);
}

function generateMockContent() {
    let sourceInfo = '';
    if (selectedSourceType === 'news' && selectedNewsSource) {
        sourceInfo = `\n\nSource: ${selectedNewsSource}`;
    }
    
    // Get direction-specific content based on content categories document
    const directionContent = getDirectionSpecificContent();
    
    // Generate platform-specific content following exact specifications
    const templates = {
        'linkedin': generateLinkedInPost(directionContent, sourceInfo),
        'facebook': generateFacebookPost(directionContent, sourceInfo),
        'instagram': generateInstagramPost(directionContent, sourceInfo),
        'twitter': generateTwitterPost(directionContent, sourceInfo),
        'youtube_shorts': generateYouTubeShortsScript(directionContent, sourceInfo),
        'blog': generateBlogArticle(directionContent, sourceInfo)
    };
    
    return templates[selectedContentType] || 'Generated content will appear here.';
}

function getDirectionSpecificContent() {
    const directionContent = {
        'business_finance': {
            keywords: ['market analysis', 'investment insights', 'corporate trends', 'financial growth', 'business strategy'],
            hashtags: {
                linkedin: ['#BusinessGrowth', '#InvestmentInsights'],
                facebook: ['#BusinessTips', '#Finance', '#Investment', '#Growth', '#Success'],
                instagram: ['#BusinessGrowth', '#Investment', '#Finance', '#Success', '#Entrepreneur', '#Wealth', '#Money', '#Strategy', '#Innovation', '#Leadership'],
                twitter: ['#Business', '#Finance']
            },
            tone: 'professional, authoritative, insightful',
            focus: 'market analysis, investment insights, corporate trends'
        },
        'technology': {
            keywords: ['tech innovation', 'digital transformation', 'industry disruption', 'AI advancement', 'software development'],
            hashtags: {
                linkedin: ['#TechInnovation', '#DigitalTransformation'],
                facebook: ['#TechNews', '#Innovation', '#Digital', '#Technology', '#Future'],
                instagram: ['#TechInnovation', '#DigitalTransformation', '#AI', '#Innovation', '#Technology', '#Future', '#Digital', '#Software', '#Development', '#Disruption'],
                twitter: ['#Tech', '#Innovation']
            },
            tone: 'forward-thinking, innovative, technical',
            focus: 'tech innovation, digital transformation, industry disruption'
        },
        'health_wellness': {
            keywords: ['wellness insights', 'health trends', 'fitness motivation', 'mental health', 'nutrition tips'],
            hashtags: {
                linkedin: ['#HealthInsights', '#WellnessTrends'],
                facebook: ['#HealthTips', '#Wellness', '#Fitness', '#Health', '#Motivation'],
                instagram: ['#HealthTips', '#Wellness', '#Fitness', '#Health', '#Motivation', '#Lifestyle', '#Nutrition', '#MentalHealth', '#SelfCare', '#Wellbeing'],
                twitter: ['#Health', '#Wellness']
            },
            tone: 'supportive, informative, encouraging',
            focus: 'professional health insights, industry trends, research'
        },
        'education': {
            keywords: ['learning methodologies', 'skill development', 'academic insights', 'educational innovation', 'knowledge sharing'],
            hashtags: {
                linkedin: ['#LearningInnovation', '#SkillDevelopment'],
                facebook: ['#Education', '#Learning', '#Skills', '#Knowledge', '#Growth'],
                instagram: ['#Education', '#Learning', '#Skills', '#Knowledge', '#Growth', '#Innovation', '#Development', '#Academic', '#Study', '#Success'],
                twitter: ['#Education', '#Learning']
            },
            tone: 'educational, inspiring, informative',
            focus: 'learning methodologies, skill development, academic insights'
        },
        'entertainment': {
            keywords: ['industry analysis', 'behind-the-scenes insights', 'trending content', 'media innovation', 'creative expression'],
            hashtags: {
                linkedin: ['#EntertainmentIndustry', '#MediaInsights'],
                facebook: ['#Entertainment', '#Movies', '#Music', '#Trending', '#Fun'],
                instagram: ['#Entertainment', '#Movies', '#Music', '#Trending', '#Fun', '#Creative', '#Media', '#Culture', '#Art', '#Expression'],
                twitter: ['#Entertainment', '#Trending']
            },
            tone: 'engaging, creative, trend-aware',
            focus: 'industry analysis, behind-the-scenes insights, trends'
        },
        'travel_tourism': {
            keywords: ['destination insights', 'travel trends', 'tourism innovation', 'cultural experiences', 'hospitality insights'],
            hashtags: {
                linkedin: ['#TravelIndustry', '#TourismInsights'],
                facebook: ['#Travel', '#Adventure', '#Destinations', '#Explore', '#Journey'],
                instagram: ['#Travel', '#Adventure', '#Destinations', '#Explore', '#Journey', '#Wanderlust', '#Vacation', '#Culture', '#Experience', '#Discovery'],
                twitter: ['#Travel', '#Tourism']
            },
            tone: 'inspiring, adventurous, informative',
            focus: 'business travel, industry insights, market trends'
        }
    };
    
    return directionContent[selectedDirection] || directionContent['business_finance'];
}

function generateLinkedInPost(directionContent, sourceInfo) {
    // LinkedIn: 1,300 chars max, Professional tone, Hook + Value + CTA, 1-2 hashtags
    const source = selectedNewsSource || 'reliable sources';
    const keywords = directionContent.keywords;
    const hashtags = directionContent.hashtags.linkedin.join(' ');
    
    return `🚀 **BREAKING: ${keywords[0].toUpperCase()}**\n\nAccording to recent reports from ${source}, we're witnessing unprecedented ${keywords[1]} in our industry. This isn't just another trend—it's a fundamental shift that will reshape how we approach ${keywords[2]}.\n\n**Key Insights:**\n• ${keywords[3]} is accelerating faster than predicted\n• Companies embracing ${keywords[4]} are seeing 3x better results\n• Early adopters are gaining significant competitive advantages\n\n**What This Means for You:**\nWhether you're a seasoned professional or just starting out, understanding these developments is crucial for career growth and business success.\n\n**The Question:**\nHow are you preparing for these changes in your field? Share your thoughts below—I'd love to hear your perspective on this evolving landscape.\n\n${hashtags}${sourceInfo}`;
}

function generateFacebookPost(directionContent, sourceInfo) {
    // Facebook: 40-80 words optimal, Conversational tone, Story + Connection + Engagement, 3-5 hashtags
    const source = selectedNewsSource || 'reliable sources';
    const keywords = directionContent.keywords;
    const hashtags = directionContent.hashtags.facebook.join(' ');
    
    return `Hey friends! 👋\n\nI just came across some really interesting news from ${source} that I had to share with you all.\n\nApparently, there's been a huge breakthrough in ${keywords[0]} that's going to change everything we know about ${keywords[1]}. I was reading about it this morning and honestly, it blew my mind! 🤯\n\nWhat do you think about these new developments? Are you excited about the possibilities, or do you have concerns?\n\nDrop a comment below and let's chat about it! I'd love to hear your thoughts.\n\n${hashtags}${sourceInfo}`;
}

function generateInstagramPost(directionContent, sourceInfo) {
    // Instagram: 2,200 chars max, Visual/Inspirational tone, Hook + Story + Hashtags, 5-10 hashtags
    const source = selectedNewsSource || 'reliable sources';
    const keywords = directionContent.keywords;
    const hashtags = directionContent.hashtags.instagram.join(' ');
    
    return `✨ **INSPIRATION ALERT** ✨\n\nToday's dose of motivation comes from some incredible developments in ${keywords[0]} that I discovered through ${source}.\n\n🌟 **The Story:**\nWhen I first read about these breakthroughs in ${keywords[1]}, I couldn't help but feel inspired by the endless possibilities that lie ahead. It's amazing how ${keywords[2]} continues to evolve and push boundaries.\n\n💭 **The Takeaway:**\nThis reminds us that innovation is everywhere—we just need to keep our eyes open and our minds ready to embrace new ideas.\n\n🔥 **The Question:**\nWhat's inspiring you today? What recent developments have caught your attention and sparked your creativity?\n\nShare your thoughts below! Let's inspire each other. 💫\n\n${hashtags}${sourceInfo}`;
}

function generateTwitterPost(directionContent, sourceInfo) {
    // Twitter: 280 chars max, Concise/trending tone, Hook + Value + Hashtag, 1-2 hashtags
    const source = selectedNewsSource || 'reliable sources';
    const keywords = directionContent.keywords;
    const hashtags = directionContent.hashtags.twitter.join(' ');
    
    return `🚨 BREAKING: Major ${keywords[0]} developments reported by ${source}!\n\nThis changes everything in ${keywords[1]}. Game-changer for the industry.\n\nThoughts? ${hashtags}${sourceInfo}`;
}

function generateYouTubeShortsScript(directionContent, sourceInfo) {
    // YouTube Shorts: 30-45 seconds, Engaging/educational tone, Hook + Content + CTA
    const source = selectedNewsSource || 'reliable sources';
    const keywords = directionContent.keywords;
    
    return `[HOOK: 0-3 seconds]\n"Hey there! You won't BELIEVE what just happened in ${keywords[0]}!"\n\n[CONTENT: 3-40 seconds]\nAccording to ${source}, we're seeing revolutionary changes in ${keywords[1]} that will impact everyone. Here's what you need to know:\n\n• ${keywords[2]} is evolving faster than ever\n• Companies are adapting to new ${keywords[3]} strategies\n• The future of ${keywords[4]} looks incredibly promising\n\n[CALL TO ACTION: 40-45 seconds]\nDon't forget to like, subscribe, and share your thoughts in the comments below! What do you think about these developments?${sourceInfo}`;
}

function generateBlogArticle(directionContent, sourceInfo) {
    // Blog: 1,500-2,500 words, Informative/authoritative tone, SEO-optimized structure
    const source = selectedNewsSource || 'reliable sources';
    const keywords = directionContent.keywords;
    
    return `# The Future of ${directionContent.focus.split(',')[0].toUpperCase()}: A Comprehensive Analysis\n\n## Introduction\nIn today's rapidly evolving landscape, understanding the key trends and developments in ${keywords[0]} is crucial for success. Recent reports from ${source} highlight significant developments that are reshaping our industry.\n\n## Current State of ${keywords[1].split(' ')[0]}\nThe landscape of ${keywords[1]} has undergone remarkable transformations in recent years. According to industry experts and recent data from ${source}, we're witnessing unprecedented changes that demand our attention.\n\n## Key Developments and Trends\n\n### 1. ${keywords[2].split(' ')[0]} Evolution\nRecent breakthroughs in ${keywords[2]} have opened new possibilities for professionals and businesses alike. These developments represent a fundamental shift in how we approach industry challenges.\n\n### 2. Impact on ${keywords[3].split(' ')[0]}\nThe implications of these changes extend far beyond immediate applications. Companies that embrace ${keywords[3]} are positioning themselves for long-term success in an increasingly competitive market.\n\n### 3. Future Outlook for ${keywords[4].split(' ')[0]}\nLooking ahead, the trajectory of ${keywords[4]} suggests continued innovation and growth. Early adopters stand to gain significant advantages in this evolving landscape.\n\n## What This Means for Professionals\n\n### For Industry Leaders\nUnderstanding these developments is essential for strategic decision-making and maintaining competitive advantages.\n\n### For Emerging Professionals\nThese changes present unique opportunities for career growth and skill development in high-demand areas.\n\n### For Businesses\nAdapting to these trends requires proactive planning and investment in relevant technologies and methodologies.\n\n## Actionable Insights\n\n1. **Stay Informed**: Regularly monitor developments in ${keywords[0]} through reliable sources like ${source}\n2. **Embrace Change**: Be open to new approaches and methodologies in your field\n3. **Invest in Learning**: Continuously develop skills related to emerging trends\n4. **Network Actively**: Connect with professionals who are leading innovation in these areas\n\n## Conclusion\nAs we navigate this dynamic landscape, staying informed and adaptable is more important than ever. The developments in ${keywords[0]} represent both challenges and opportunities for those willing to embrace change and innovation.\n\nBy understanding these trends and taking proactive steps to adapt, professionals and businesses can position themselves for success in an increasingly competitive and innovative environment.${sourceInfo}`;
}

function displayContent(content) {
    generatedContent = content;
    
    // Add character count and validation based on content categories
    const charCount = content.length;
    const platformLimits = {
        'linkedin': 1300,
        'facebook': 63206,
        'instagram': 2200,
        'twitter': 280,
        'youtube_shorts': null, // No character limit for scripts
        'blog': null // No character limit for blog articles
    };
    
    const limit = platformLimits[selectedContentType];
    let validationMessage = '';
    let validationClass = '';
    
    if (limit) {
        if (charCount > limit) {
            validationMessage = `⚠️ Content exceeds ${selectedContentType} limit (${charCount}/${limit} characters)`;
            validationClass = 'text-danger';
        } else if (charCount > limit * 0.9) {
            validationMessage = `⚠️ Content approaching ${selectedContentType} limit (${charCount}/${limit} characters)`;
            validationClass = 'text-warning';
        } else {
            validationMessage = `✅ Content within ${selectedContentType} limits (${charCount}/${limit} characters)`;
            validationClass = 'text-success';
        }
    } else {
        validationMessage = `📝 Content length: ${charCount} characters`;
        validationClass = 'text-info';
    }
    
    const displayContent = `
        <div class="mb-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <small class="${validationClass}">${validationMessage}</small>
                <small class="text-muted">${getPlatformSpecs()}</small>
            </div>
            <pre class="mb-0">${content}</pre>
        </div>
    `;
    
    $('#contentPreview').html(displayContent);
    
    // Store original content for translation
    $('#contentPreview').data('original-content', content);
    
    // Show content actions and translation controls
    $('#contentActions').show();
    showTranslationControls();
}

function getPlatformSpecs() {
    const specs = {
        'linkedin': 'LinkedIn: 1,300 chars max, Professional tone, 1-2 hashtags',
        'facebook': 'Facebook: 63,206 chars max, Conversational tone, 3-5 hashtags',
        'instagram': 'Instagram: 2,200 chars max, Visual tone, 5-10 hashtags',
        'twitter': 'Twitter: 280 chars max, Concise tone, 1-2 hashtags',
        'youtube_shorts': 'YouTube Shorts: 30-45 seconds, Engaging tone',
        'blog': 'Blog: 1,500-2,500 words, Informative tone, SEO-optimized'
    };
    
    return specs[selectedContentType] || '';
}

function showTranslationControls() {
    $('#translationControls').show();
    // Set initial state to English
    currentContentLanguage = 'en';
    updateTranslationButtons();
}

function translateContent(targetLang) {
    const originalContent = $('#contentPreview').data('original-content');
    const currentLang = currentContentLanguage || 'en';
    
    if (targetLang === currentLang) {
        return; // Already in the target language
    }
    
    // Show loading state
    const button = targetLang === 'en' ? $('#translateEn') : $('#translateZh');
    const originalText = button.html();
    button.prop('disabled', true).html('<i class="fas fa-spinner fa-spin me-1"></i> Translating...');
    
    // Call translation API
    fetch('/api/translate', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            content: originalContent,
            target_lang: targetLang,
            source_lang: currentLang
        })
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            // Update content display
            $('#contentPreview').html(`<pre class="mb-0">${data.translated_content}</pre>`);
            currentContentLanguage = targetLang;
            updateTranslationButtons();
            
            // Update generated content for copy/download
            generatedContent = data.translated_content;
        } else {
            // Fallback to mock translation for demo
            const mockTranslation = getMockTranslation(originalContent, targetLang);
            $('#contentPreview').html(`<pre class="mb-0">${mockTranslation}</pre>`);
            currentContentLanguage = targetLang;
            updateTranslationButtons();
            generatedContent = mockTranslation;
        }
    })
    .catch(error => {
        console.error('Translation error:', error);
        // Fallback to mock translation
        const mockTranslation = getMockTranslation(originalContent, targetLang);
        $('#contentPreview').html(`<pre class="mb-0">${mockTranslation}</pre>`);
        currentContentLanguage = targetLang;
        updateTranslationButtons();
        generatedContent = mockTranslation;
    })
    .finally(() => {
        button.prop('disabled', false).html(originalText);
    });
}

function getMockTranslation(content, targetLang) {
    if (targetLang === 'zh') {
        // Enhanced Chinese translation for new content structure
        return content
            // LinkedIn translations
            .replace(/🚀 \*\*BREAKING: /g, '🚀 **突发：')
            .replace(/According to recent reports from /g, '根据来自')
            .replace(/we're witnessing unprecedented /g, '我们正在见证前所未有的')
            .replace(/This isn't just another trend—it's a fundamental shift/g, '这不仅仅是另一个趋势——这是一个根本性的转变')
            .replace(/Key Insights:/g, '关键见解：')
            .replace(/is accelerating faster than predicted/g, '比预期加速得更快')
            .replace(/Companies embracing /g, '采用')
            .replace(/are seeing 3x better results/g, '的公司看到了3倍更好的结果')
            .replace(/Early adopters are gaining significant competitive advantages/g, '早期采用者正在获得显著的竞争优势')
            .replace(/What This Means for You:/g, '这对您意味着什么：')
            .replace(/Whether you're a seasoned professional or just starting out/g, '无论您是经验丰富的专业人士还是刚刚起步')
            .replace(/understanding these developments is crucial for career growth/g, '了解这些发展对职业发展至关重要')
            .replace(/The Question:/g, '问题：')
            .replace(/How are you preparing for these changes in your field?/g, '您如何为所在领域的这些变化做准备？')
            .replace(/Share your thoughts below—I'd love to hear your perspective/g, '在下面分享您的想法——我很想听听您的观点')
            
            // Facebook translations
            .replace(/Hey friends! 👋/g, '朋友们好！👋')
            .replace(/I just came across some really interesting news/g, '我刚刚看到一些非常有趣的新闻')
            .replace(/that I had to share with you all/g, '必须与大家分享')
            .replace(/Apparently, there's been a huge breakthrough in /g, '显然，在')
            .replace(/that's going to change everything we know about /g, '方面有了重大突破，这将改变我们对')
            .replace(/I was reading about it this morning and honestly, it blew my mind! 🤯/g, '的一切认知。我今早读到这个消息，说实话，让我震惊了！🤯')
            .replace(/What do you think about these new developments?/g, '您对这些新发展有什么看法？')
            .replace(/Are you excited about the possibilities, or do you have concerns?/g, '您对可能性感到兴奋，还是有担忧？')
            .replace(/Drop a comment below and let's chat about it!/g, '在下面留言，让我们聊聊吧！')
            .replace(/I'd love to hear your thoughts/g, '我很想听听您的想法')
            
            // Instagram translations
            .replace(/✨ \*\*INSPIRATION ALERT\*\* ✨/g, '✨ **灵感提醒** ✨')
            .replace(/Today's dose of motivation comes from/g, '今天的动力来自于')
            .replace(/incredible developments in /g, '令人难以置信的发展')
            .replace(/that I discovered through /g, '我通过')
            .replace(/🌟 \*\*The Story:\*\*/g, '🌟 **故事：**')
            .replace(/When I first read about these breakthroughs in /g, '当我第一次读到这些突破时')
            .replace(/I couldn't help but feel inspired by the endless possibilities/g, '我不禁被无限的可能性所激励')
            .replace(/It's amazing how /g, '令人惊讶的是')
            .replace(/continues to evolve and push boundaries/g, '如何继续发展并突破界限')
            .replace(/💭 \*\*The Takeaway:\*\*/g, '💭 **要点：**')
            .replace(/This reminds us that innovation is everywhere/g, '这提醒我们创新无处不在')
            .replace(/we just need to keep our eyes open and our minds ready/g, '我们只需要保持眼睛开放，思维准备就绪')
            .replace(/🔥 \*\*The Question:\*\*/g, '🔥 **问题：**')
            .replace(/What's inspiring you today?/g, '今天什么激励着您？')
            .replace(/What recent developments have caught your attention/g, '最近哪些发展引起了您的注意')
            .replace(/and sparked your creativity?/g, '并激发了您的创造力？')
            .replace(/Share your thoughts below! Let's inspire each other. 💫/g, '在下面分享您的想法！让我们互相激励。💫')
            
            // Twitter translations
            .replace(/🚨 BREAKING: Major /g, '🚨 突发：重大')
            .replace(/developments reported by /g, '发展由')
            .replace(/This changes everything in /g, '这改变了一切')
            .replace(/Game-changer for the industry/g, '行业的游戏规则改变者')
            .replace(/Thoughts?/g, '想法？')
            
            // YouTube translations
            .replace(/Hey there! You won't BELIEVE what just happened in /g, '大家好！您不会相信刚刚在')
            .replace(/According to /g, '根据')
            .replace(/we're seeing revolutionary changes in /g, '我们正在看到革命性的变化')
            .replace(/that will impact everyone/g, '这将影响每个人')
            .replace(/Here's what you need to know:/g, '以下是您需要了解的：')
            .replace(/is evolving faster than ever/g, '比以往任何时候都发展得更快')
            .replace(/Companies are adapting to new /g, '公司正在适应新的')
            .replace(/strategies/g, '策略')
            .replace(/The future of /g, '的未来')
            .replace(/looks incredibly promising/g, '看起来非常有希望')
            .replace(/Don't forget to like, subscribe, and share your thoughts/g, '别忘了点赞、订阅并分享您的想法')
            .replace(/What do you think about these developments?/g, '您对这些发展有什么看法？')
            
            // Blog translations
            .replace(/The Future of /g, '的未来')
            .replace(/A Comprehensive Analysis/g, '综合分析')
            .replace(/In today's rapidly evolving landscape/g, '在当今快速发展的环境中')
            .replace(/understanding the key trends and developments in /g, '了解关键趋势和发展')
            .replace(/is crucial for success/g, '对成功至关重要')
            .replace(/Recent reports from /g, '来自')
            .replace(/highlight significant developments/g, '的最新报告突出了重要发展')
            .replace(/that are reshaping our industry/g, '正在重塑我们的行业')
            .replace(/The landscape of /g, '的格局')
            .replace(/has undergone remarkable transformations/g, '经历了显著的转变')
            .replace(/According to industry experts and recent data/g, '根据行业专家和最新数据')
            .replace(/we're witnessing unprecedented changes/g, '我们正在见证前所未有的变化')
            .replace(/that demand our attention/g, '需要我们的关注')
            .replace(/Key Developments and Trends/g, '关键发展和趋势')
            .replace(/Recent breakthroughs in /g, '最近的突破')
            .replace(/have opened new possibilities/g, '开辟了新的可能性')
            .replace(/These developments represent a fundamental shift/g, '这些发展代表了一个根本性的转变')
            .replace(/in how we approach industry challenges/g, '在我们应对行业挑战的方式上')
            .replace(/The implications of these changes extend far beyond/g, '这些变化的影响远远超出了')
            .replace(/Companies that embrace /g, '采用')
            .replace(/are positioning themselves for long-term success/g, '的公司正在为长期成功定位')
            .replace(/in an increasingly competitive market/g, '在日益竞争的市场中')
            .replace(/Looking ahead, the trajectory of /g, '展望未来，')
            .replace(/suggests continued innovation and growth/g, '的轨迹表明持续的创新和增长')
            .replace(/Early adopters stand to gain significant advantages/g, '早期采用者将获得显著优势')
            .replace(/in this evolving landscape/g, '在这个不断发展的环境中')
            .replace(/What This Means for Professionals/g, '这对专业人士意味着什么')
            .replace(/For Industry Leaders/g, '对于行业领导者')
            .replace(/Understanding these developments is essential/g, '了解这些发展是必要的')
            .replace(/for strategic decision-making/g, '对于战略决策')
            .replace(/and maintaining competitive advantages/g, '和保持竞争优势')
            .replace(/For Emerging Professionals/g, '对于新兴专业人士')
            .replace(/These changes present unique opportunities/g, '这些变化提供了独特的机会')
            .replace(/for career growth and skill development/g, '对于职业发展和技能发展')
            .replace(/in high-demand areas/g, '在高需求领域')
            .replace(/For Businesses/g, '对于企业')
            .replace(/Adapting to these trends requires/g, '适应这些趋势需要')
            .replace(/proactive planning and investment/g, '主动规划和投资')
            .replace(/in relevant technologies and methodologies/g, '在相关技术和方法上')
            .replace(/Actionable Insights/g, '可操作的见解')
            .replace(/Stay Informed/g, '保持信息灵通')
            .replace(/Regularly monitor developments in /g, '定期监控')
            .replace(/through reliable sources like /g, '通过可靠来源如')
            .replace(/Embrace Change/g, '拥抱变化')
            .replace(/Be open to new approaches and methodologies/g, '对新方法和方法保持开放')
            .replace(/Invest in Learning/g, '投资学习')
            .replace(/Continuously develop skills related to emerging trends/g, '持续发展相关技能')
            .replace(/Network Actively/g, '积极建立网络')
            .replace(/Connect with professionals who are leading innovation/g, '与引领创新的专业人士联系')
            .replace(/in these areas/g, '在这些领域')
            .replace(/As we navigate this dynamic landscape/g, '当我们在这个动态环境中导航时')
            .replace(/staying informed and adaptable is more important than ever/g, '保持信息灵通和适应能力比以往任何时候都更重要')
            .replace(/The developments in /g, '的发展')
            .replace(/represent both challenges and opportunities/g, '既代表挑战也代表机遇')
            .replace(/for those willing to embrace change and innovation/g, '对于那些愿意拥抱变化和创新的人')
            .replace(/By understanding these trends and taking proactive steps/g, '通过了解这些趋势并采取主动措施')
            .replace(/professionals and businesses can position themselves for success/g, '专业人士和企业可以为成功定位')
            .replace(/in an increasingly competitive and innovative environment/g, '在日益竞争和创新的环境中');
    } else {
        // Return to English (original content)
        return $('#contentPreview').data('original-content');
    }
}

function updateTranslationButtons() {
    if (currentContentLanguage === 'en') {
        $('#translateEn').addClass('active').removeClass('btn-outline-primary').addClass('btn-primary');
        $('#translateZh').removeClass('active').removeClass('btn-primary').addClass('btn-outline-warning');
        $('.content-language.en').show();
        $('.content-language.zh').hide();
    } else {
        $('#translateZh').addClass('active').removeClass('btn-outline-warning').addClass('btn-warning');
        $('#translateEn').removeClass('active').removeClass('btn-primary').addClass('btn-outline-primary');
        $('.content-language.zh').show();
        $('.content-language.en').hide();
    }
}

function saveContent() {
    // TODO: Implement save functionality
    alert('Content saved to library!');
}

function downloadContent() {
    // TODO: Implement download functionality
    alert('Content downloaded!');
}

function copyContent() {
    if (generatedContent) {
        navigator.clipboard.writeText(generatedContent).then(() => {
            alert('Content copied to clipboard!');
        });
    }
}
</script>
{% endblock %} 